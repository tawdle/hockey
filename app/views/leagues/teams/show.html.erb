<% title [@team.name, @team.city, @team.league.name].compact.join(" - ") %>
<div class="row team-show">

  <div class="span8">
    <div class="team-name-block">
      <% if @team.alpha_logo.present? %>
        <%= cl_image_tag @team.alpha_logo_url(:large), :alt => "team logo" %>
      <% end %>

      <div class="team-name">
        <%= @team.name %>
        <%= link_to t("actions.edit"), edit_team_path(@team), :class => "btn btn-small" if can? :edit, @team %>
        <%= render :partial => "follow_button", :locals => {:target => @team } %>
      </div>
      <div><%= format_team_link(@team) %></div>
      <%= @team.city %><br>
      <div class="byline"><em><%= t(".a_member_of_html", :league_link => link_to(@team.league.name, @team.league)) %></em></div>
    </div>

    <br />

    <h3><%= Player.model_name.human.pluralize %>
      <%= link_to t("team.add_player"), new_team_player_path(@team), :class => "btn" if can? :create, Player.new(:team => @team) %>
      <%= link_to(t(".get_private_link"), team_claims_path(:team_claim => {:team_id => @team.to_param}), :class => "btn", :method => :post) if can?(:create, TeamClaim.new(:team => @team)) %>
    </h3>

    <% show_user = current_user && current_user.manager_of?(@team) %>

    <table class="table table-hover">
      <tr>
        <th><%= Player.human_attribute_name(:photo) %></th>
        <th style="width: 20px;">#</th>
        <th><%= Player.human_attribute_name(:name) %></th>
        <th><%= Player.human_attribute_name(:role) %></th>
        <% if show_user %>
          <th><%= User.model_name.human %></th>
        <% end %>
        <th></th>
      </tr>

      <% @team.players.each do |player| %>
        <tr>
          <td><%= link_to player do %>
            <%= cl_image_tag(player.photo_url(:thumbnail)) %>
          <% end %>
          </td>
          <td><%= link_to player.jersey_number, player %></td>
          <td><%= link_to player.name, player %></td>
          <td><%= t(player.role, :scope => "activerecord.values.player.role") %></td>
          <% if show_user %>
            <td>
              <% if player.user %>
                <%= format_user_link(player.user) %>
              <% elsif Invitation.pending.for_target(player).any? %>
                <span class="text-success"><i class="icon-check"></i> <%= t("player.invitation_sent") %></span>
              <% else %>
                <%= invitation_button(:claim, player, {:label => t("player.invite_claim.button"), :back_to => team_path(@team) }) %>
              <% end %>
            </td>
          <% end %>
          <td>
            <%= link_to t("actions.edit"), edit_player_path(player) if can? :edit, player %>
            <%= link_to t("actions.remove"), player, method: :delete, data: { confirm: t("actions.confirm") } if can? :delete, player %>
          </td>
        </tr>
      <% end %>
    </table>

    <br />


    <br />

    <% if Game.for_team(@team).scheduled_or_active.any? %>
      <%= render :partial => "games", :locals => { :games => Game.for_team(@team).scheduled_or_active } %>
    <% end %>

    <%= render :partial => "activity_feed", :locals => {:activity_feed_items => @team.activity_feed_items, :in_game_context => false } %>

  </div>

  <div class="span4">
    <%= render :partial => "mini_sign_up" unless current_user %>
    <%= render :partial => "followers", :locals => {:target => @team } %>
    <div class="well">
      <h4><%= t("manager", :scope => "activerecord.values.authorization.role").pluralize %>
        <% if can?(:create, Invitation.new(:target => @team)) %>
          <%= link_to 'Invite', new_invitation_path(:predicate => :manage, :target_id => @team.to_param, :target_type => "Team"), :class => "btn btn-small" %>
      <% end %>
      </h4>

      <%= @team.managers.collect {|manager| format_user_link(manager) }.join(", ").html_safe %>
    </div>

    <div class="well">
      <h4><%= StaffMember.model_name.human.pluralize %>
        <%= link_to "Edit", team_staff_members_path(@team), :class => "btn btn-small" if can? :update, @team %>
      </h4>
      <p> <%= @team.staff_members.sort_by {|sm| StaffMember::Roles.index(sm.role) || 0}.collect(&:name_and_role).join(", ") || "<em>none</em>".html_safe %> </p>
    </div>
  </div>
</div>


<%= link_to t("navigation.back_html"), root_path %>
