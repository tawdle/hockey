<h2 class="page-header">
  <% if @league.logo.present? %>
    <%= image_tag @league.logo_url(:thumbnail), :height => 50, :width => 50, :style => "float: left; margin-right: 10px" %>
  <% end %>
  <%= @league.name %>
  <small>(<%= link_to 'edit', edit_league_path(@league) %>)</small>
</h2>

<h3>Managers
<small>
  (<%= link_to 'invite', new_invitation_path(:predicate => :manage, :target_id => @league.to_param, :target_type => "League") %>)
</small>
</h3>

<%= @league.managers.collect {|manager| format_user_link(manager) }.join(", ").html_safe || "(none)" %>

<h3>Recorders
<small>
  (<%= link_to 'invite', new_invitation_path(:predicate => :record, :target_id => @league.to_param, :target_type => "League") %>)
</small>
</h3>

<%= @league.recorders.collect {|recorder| format_user_link(recorder) }.join(", ").html_safe || "(none)" %>

<h3 class="page-header">Current Games</h3>

<table class="table table-hover">
  <tr>
    <th>Status</th>
    <th>When</th>
    <th>Home Team</th>
    <th><i>vs</i></th>
    <th>Visting Team</th>
    <th>Location</th>
    <th>Score</th>
    <th />
  </tr>

  <% Game.for_league(@league).scheduled_or_active.asc.each do |game| %>
    <tr>
      <td><%= link_to game.state.humanize, game %></td>
      <td><%= game.start_time.to_s(:long) %></td>
      <td><%= link_to game.home_team.name, game.home_team %></td>
      <td></td>
      <td><%= link_to game.visiting_team.name, game.visiting_team %></td>
      <td><%= game.location.name %></td>
      <td><%= "#{game.home_team_score} - #{game.visiting_team_score}" if game.active? %></td>
      <td>
        <%= link_to "Change", edit_league_game_path(@league, game), :class => "btn" if game.scheduled? && can?(:edit, game) %>
        <%= link_to "Cancel", game, method: :delete, data: { confirm: 'Are you sure you want to cancel this game?' }, class: "btn" if (game.scheduled? && can?(:destroy, game)) %>
      </td>
    </tr>
  <% end %>
</table>

<h3 class="page-header">Past Games</h3>

<table class="table table-hover">
  <tr>
    <th>When</th>
    <th>Home Team</th>
    <th><i>vs</i></th>
    <th>Visting Team</th>
    <th>Location</th>
    <th>Score</th>
  </tr>

  <% Game.for_league(@league).finished.desc.each do |game| %>
    <tr>
      <td><%= game.start_time.to_s(:long) %></td>
      <td><%= game.home_team.name %></td>
      <td></td>
      <td><%= game.visiting_team.name %></td>
      <td><%= game.location.name %></td>
      <td><%= "#{game.home_team_score} - #{game.visiting_team_score}" %></td>
    </tr>
  <% end %>
</table>



<%= link_to "Schedule a New Game", new_league_game_path(@league), :class => "btn" %>

<h3>Teams</h3>

<table class="table table-hover">
  <tr>
    <th style="width: 50px;">Logo</th>
    <th>Name</th>
    <th></th>
    <th></th>
  </tr>

  <% @league.teams.each do |team| %>
    <tr>
      <td><%= image_tag team.logo_url(:thumbnail), :height => 50, :width => 50 if team.logo.present? %></td>
      <td><%= link_to team.name, team %></td>
      <td><%= link_to 'Edit', edit_team_path(team) if can? :edit, team %></td>
      <td><%= link_to 'Destroy', team, method: :delete, data: { confirm: 'Are you sure?' } if can? :destroy, team %></td>
    </tr>
  <% end %>
</table>

<%= link_to "New Team", new_league_team_path(@league), :class => "btn" %>

<h3>Officials</h3>

<table class="table table-hover">
  <thead>
    <tr>
      <th>Name</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <% @league.officials.each do |official| %>
      <tr>
        <td><%= link_to official.name, league_official_path(@league, official) %>
        <td><%= link_to "Edit", edit_league_official_path(@league, official) if can? :edit, official %></td>
        <td><%= link_to "Remove", league_official_path(@league, official), :method => :delete, :data => { confirm: 'Remove this official?' } if can? :destroy, official %>
      </tr>
    <% end %>
  </tbody>
</table>

<%= link_to "New Official", new_league_official_path(@league), :class => "btn" %>

<%= link_to 'Back', leagues_path %>
