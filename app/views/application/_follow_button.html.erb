<% if current_user %>
  <% unfollowing = Following.lookup(current_user, target)
     following = Following.new(:user => current_user, :target => target) unless unfollowing || current_user == target
   %>

  <% if following %>
    <%= form_for following do |f| %>
      <%= f.hidden_field :user_id %>
      <%= f.hidden_field :target_id %>
      <%= f.submit "Follow", :class => "btn btn-mini btn-primary" %>
    <% end %>
  <% elsif unfollowing %>
    <%= form_for unfollowing, :method => "delete" do |f| %>
      <%= f.hidden_field :id %>
      <%= f.submit "Unfollow", :class => "btn btn-mini" %>
    <% end %>
  <% end %>
<% end %>
